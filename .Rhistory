total<-rbind(points,newrow)
DeepSmall<-merge(DeepSmall,points,by="Study")
DeepSmall1<-DeepSmall
DeepSmall1$Study <- factor(DeepSmall1$Study, levels = c("INDIANOCEAN2006","STRATIPHYT1","NORTHSEA2001","STRATIPHYT2","GREENLAND2012","CASES03-04","USC MO", "KH05_2", "GEOTRACES_LEG3", "KH04_5", "GEOTRACES","BATS"))
total <- total[order(total1$Freq[1:12]),]
x1<-x
x1$Study <- factor(x$Study, levels = c("INDIANOCEAN2006","STRATIPHYT1","NORTHSEA2001","STRATIPHYT2","GREENLAND2012","CASES03-04","USC MO", "KH05_2", "GEOTRACES_LEG3", "KH04_5", "GEOTRACES","BATS"))
lme2<-lme(log10VIRUS~log10BACTERIA, random=~1+log10BACTERIA|Study,data=DeepSmall)
ls2<-summary(lme2)
studies<-levels(DeepSmall$Study)
rsqs<-c()
studycol<-c()
pvals<-c()
for (i in seq(1:length(levels(DeepSmall$Study)))){
sub<-DeepSmall[which(DeepSmall$Study == studies[i]),]
foo <- sub[, c('log10VIRUS','log10BACTERIA')]
mod<-lm(sub$log10VIRUS ~ sub$log10BACTERIA)
foo$yhat <- (sub$log10BACTERIA*coef(mod)[2])+coef(mod)[1]
foo$e <- foo$log10VIRUS - foo$yhat
SST <- sum( (foo$log10VIRUS - mean(foo$log10VIRUS))^2 )
SSC <- sum( (foo$e)^2 )
(SST-SSC)/SST
studycol<-c(studycol,studies[i])
rsqs<-c(rsqs,round((SST-SSC)/SST,3))
summary<-summary(mod)
pval<-summary$coefficients[2,4]
pvals<-c(pvals,as.numeric(format(pval, scientific = TRUE, digits = 3)))
}
rsqfits<-as.data.frame(cbind(Study=studycol,RSQ=rsqs,'P-Value'=pvals),rownames=F)
kable(rsqfits)
rsqtable<-rsqfits[order(as.numeric(format(pvals, scientific = TRUE, digits = 3))),]
deeprsqfits<-rsqfits[order(as.numeric(format(pvals, scientific = TRUE, digits = 3))),]
rsqtable$labelcolor<-ifelse(as.numeric(levels(rsqtable$'P-Value'))[rsqtable$'P-Value']<.05/12, 'black','grey50')
x1<-merge(x1,rsqtable,by="Study")
p<-ggplot(x1, aes(x=Study, y=slopes)) +
geom_violin(width=1.75, fill='lightblue') +
geom_boxplot(width=.4,outlier.size = 0) +
coord_flip() +
geom_abline(intercept=1, slope=0, linetype=2) +
ylab("Slope") +
theme(title = element_text(size=20),
axis.text=element_text(size=12, colour = "black"),
#axis.text.y=element_text(size=12, colour = "black"),
axis.title=element_text(size=16,face="bold"),
axis.title.y=element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.text.y = element_text(colour = c("grey50", "black", "black",  "black",  "black",  "grey50", "black",  "black",  "black",  "black",  "black",  "black"))) +
scale_y_continuous(breaks = c(seq(-.25,1.5,by=.25)),
labels = c(insert_minor(seq(-.25,1.5,by=.25),0,0)),
limits = c(0,1.5),
expand = c(0,0))
hist_right <- ggplot()+
#geom_histogram(aes(DeepSmall1$Study,fill=DeepSmall1$containsOneColor)) +
geom_histogram(aes(DeepSmall1$Study,fill=DeepSmall1$containsOneColor)) +
scale_fill_manual(name="One in CI?", values = c("black","blue"), labels=c('No','Yes')) +
coord_flip() +
labs(list(y='Frequency')) +
theme(title = element_text(size=20),
axis.text.x=element_text(size=10, colour="black"),
axis.title=element_text(size=16,face="bold"),
axis.title.y=element_blank(),
axis.text.y = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"),
axis.line.y = element_blank(),
axis.ticks.y = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
legend.key = element_rect(fill = "white"),
legend.title = element_text(size = 12),
legend.text = element_text(size = 8),
legend.key.height = unit(.2,"line"),
legend.position = c(.4,.1)) +
scale_y_reverse()
WIDTH<-5
HEIGHT<-7
vp1 <- viewport(width = 8/10, height = 12/12, x = 4/10, y = 6/12)
vp2 <- viewport(width = 2/10, height = 12/12, x = 8.75/10, y = 6/12)
grid.newpage()
pushViewport(viewport(layout = grid.layout(6,5)))
pdf("output/figures/pdf/deepbootstrap_slopes.pdf", width=8, height=8)
print(hist_right, vp = vp2)
print(p, vp = vp1)
dev.off()
jpeg("output/figures/jpg/deepbootstrap_slopes.jpg", width=600, height=600)
print(hist_right, vp = vp2)
print(p, vp = vp1)
dev.off()
save(deeprsqfits, file='output/data/DEEPRSQFITS.RData')
load("output/data/SMALLLABSET.RData")
z4<-ifelse(smallLabSet$Study == "ARCTICSBI",1,0)
z24<-ifelse(smallLabSet$Study == "BATS",1,0)
z6<-ifelse(smallLabSet$Study == "BEDFORDBASIN",1,0)
z3<-ifelse(smallLabSet$Study == "NORTHSEA2001",1,0)
z8<-ifelse(smallLabSet$Study == "CASES03-04",1,0)
#z12<-ifelse(smallLabSet$Study == "ELA",1,0)
z2<-ifelse(smallLabSet$Study == "FECYCLE1",1,0)
z22<-ifelse(smallLabSet$Study == "FECYCLE2",1,0)
z20<-ifelse(smallLabSet$Study == "GEOTRACES",1,0)
z19<-ifelse(smallLabSet$Study == "GEOTRACES_LEG3",1,0)
z16<-ifelse(smallLabSet$Study == "KH04_5",1,0)
z21<-ifelse(smallLabSet$Study == "KH05_2",1,0)
z5<-ifelse(smallLabSet$Study == "GREENLAND2012",1,0)
z25<-ifelse(smallLabSet$Study == "INDIANOCEAN2006",1,0)
z18<-ifelse(smallLabSet$Study == "MOVE",1,0)
z10<-ifelse(smallLabSet$Study == "NASB2005",1,0)
z23<-ifelse(smallLabSet$Study == "POWOW",1,0)
z17<-ifelse(smallLabSet$Study == "RAUNEFJORD2000",1,0)
z1<-ifelse(smallLabSet$Study == "SOG",1,0)
z9<-ifelse(smallLabSet$Study == "STRATIPHYT1",1,0)
z11<-ifelse(smallLabSet$Study == "STRATIPHYT2",1,0)
#z26<-ifelse(smallLabSet$Study == "SWAT",1,0)
z15<-ifelse(smallLabSet$Study == "TABASCO",1,0)
#z7<-ifelse(smallLabSet$Study == "TROUT",1,0)
z14<-ifelse(smallLabSet$Study == "USC MO",1,0)
y<-smallLabSet$log10VIRUS
x<-smallLabSet$log10BACTERIA
#summary(lm(log10VIRUS~log10BACTERIA,data=smallLabSet))$coef
#estimate + sd on lab intercepts
# 4.4427386 + 0.10995505 = 4.552694
# estimate - sd on lab intercepts
# 4.4427386 - 0.10995505 = 4.332784
variableInterceptwithconstraints<-nls(y~slope*x+SOG*z1+FECYCLE1*z2+NORTHSEA2001*z3+ARCTICSBI*z4+GREENLAND2012*z5+BEDFORDBASIN*z6+CASES0304*z8+STRATAPHYT1*z9+NASB2005*z10+STRATAPHYT2*z11+USCMO*z14+TABASCO*z15+KHO4*z16+Raunefjord*z17+MOVE*z18+GEOTRACES_LEG3*z19+GEOTRACES*z20+KH05_2*z21+FECYCLE2*z22+POWOW*z23+BATS*z24+INDIANOCEAN2006*z25,algorithm="port",
start=c(slope=0,SOG=4.332784,FECYCLE1=4.332784,NORTHSEA2001=4.332784,ARCTICSBI=4.332784,GREENLAND2012=4.332784,BEDFORDBASIN=4.332784,CASES0304=4.332784,STRATAPHYT1=4.332784,NASB2005=4.332784,STRATAPHYT2=4.332784,SCMO=4.332784,TABASCO=4.332784,KHO4=4.332784,Raunefjord=4.332784,MOVE=4.332784,GEOTRACES_LEG3=4.332784,GEOTRACES=4.332784,KH05_2=4.332784,FECYCLE2=4.332784,POWOW=4.332784,BATS=4.332784,INDIANOCEAN2006=4.332784),
lower=c(slope=-Inf,SOG=4.332784,FECYCLE1=4.332784,NORTHSEA2001=4.332784,ARCTICSBI=4.332784,GREENLAND2012=4.332784,BEDFORDBASIN=4.332784,CASES0304=4.332784,STRATAPHYT1=4.332784,NASB2005=4.332784,STRATAPHYT2=4.332784,USCMO=4.332784,TABASCO=4.332784,KHO4=4.332784,Raunefjord=4.332784,MOVE=4.332784,GEOTRACES_LEG3=4.332784,GEOTRACES=4.332784,KH05_2=4.332784,FECYCLE2=4.332784,POWOW=4.332784,BATS=4.332784,INDIANOCEAN2006=4.332784),
upper=c(slope=Inf,SOG=4.552694,FECYCLE1=4.552694,NORTHSEA2001=4.552694,ARCTICSBI=4.552694,GREENLAND2012=4.552694,BEDFORDBASIN=4.552694,CASES0304=4.552694,STRATAPHYT1=4.552694,NASB2005=4.552694,STRATAPHYT2=4.552694,USCMO=4.552694,TABASCO=4.552694,KHO4=4.552694,Raunefjord=4.552694,MOVE=4.552694,GEOTRACES_LEG3=4.552694,GEOTRACES=4.552694,KH05_2=4.552694,FECYCLE2=4.552694,POWOW=4.552694,BATS=4.552694,INDIANOCEAN2006=4.552694))
shallowcv<-variableInterceptwithconstraints
tss<-sum((smallLabSet$log10VIRUS-mean(smallLabSet$log10VIRUS))^2)
m1<-lm(smallLabSet$log10VIRUS ~ smallLabSet$log10BACTERIA)
shallowconstrained<-ggplot(smallLabSet, aes(x=log10BACTERIA, y=log10VIRUS, colour=Study)) +
geom_point(size=.01, alpha=.01) +
geom_abline(intercept=4.4806966, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.5526940, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.3327840, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.3327840, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.5526940, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.3327840, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.3362559, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.3327840, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.3399020, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.5526940, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.3327840, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.3896576, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.3327840, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.5526940, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.3327840, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.5526940, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.5526940, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.332784, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.332784, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.5130411, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.5526940, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.4089481, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.3327840, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.3327840, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.3327840, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
labs(list(x=expression(paste("Microbe abundance per mL (",log[10]," scale)")),
y=expression(paste("Virus abundance per mL (",log[10]," scale)")))) +
geom_abline(intercept=coef(m1)[[1]], slope=coef(m1)[[2]], col='#D55E00', size=2) +
geom_abline(intercept=1, slope=1, col='#0072B2', size=2) +
annotate(size=6,family="Helvetica", fontface="bold",geom="text",x = 5.0, y = 6.35, label = 'B', parse = TRUE) +
annotate(size=6,family="Helvetica", fontface="bold",geom="text",x = 5.0, y = 6.85, label = 'A', parse = TRUE) +
annotate(size=6,family="Helvetica", fontface="bold",geom="text",x = 6.75, y = 6.95, label = "Power Law", parse = F) +
annotate(size=6,family="Helvetica", fontface="bold",geom="text",x = 6.65, y = 7.95, label = as.character(paste("10","1",sep=":")), parse = F) +
theme(aspect.ratio=1,
title = element_text(size=20),
axis.text=element_text(size=16, colour="black"),
axis.title=element_text(size=16,face="bold"),
#text = element_text(size=32),aspect.ratio=1,
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"),
#legend.position = c(.1,.75),
legend.position = 'none',
legend.key = element_rect(fill = "white"),
legend.key.size = unit(.5, "cm")) +
scale_x_continuous(breaks = c(seq(4.5,9,by=.25)),
labels = c(insert_minor(seq(4.5,9,by=.5),1,1)),
#limits = c(4.6,9),
expand = c(0,0)) +
scale_y_continuous(breaks = c(seq(5.5,9,by=.25)),
labels = c(insert_minor(seq(5.5,9,by=.5),1,1)),
#limits = c(min(smallLabSet$log10VIRUS)-1,max(smallLabSet$log10VIRUS)),
#expand = c(0,0)) + colScale
expand = c(0,0))
pdf("output/figures/pdf/constrainedRegression.pdf", width=8, height=8)
print(shallowconstrained)
dev.off()
jpeg("output/figures/jpg/constrainedRegression.jpg", width=600, height=600)
print(shallowconstrained)
dev.off()
shallowvariableInterceptwithconstraints<-variableInterceptwithconstraints
saveRDS(predict(variableInterceptwithconstraints), file = "output/data/SHALLOWVARIABLEINTERCEPTWITHCONSTRAINTS.rds")
save(shallowvariableInterceptwithconstraints, file = "output/data/SHALLOWCONSTRAINTS.RData")
load("output/data/SMALLLABSET.RData")
z4<-ifelse(smallLabSet$Study == "ARCTICSBI",1,0)
z24<-ifelse(smallLabSet$Study == "BATS",1,0)
z6<-ifelse(smallLabSet$Study == "BEDFORDBASIN",1,0)
z3<-ifelse(smallLabSet$Study == "NORTHSEA2001",1,0)
z8<-ifelse(smallLabSet$Study == "CASES03-04",1,0)
#z12<-ifelse(smallLabSet$Study == "ELA",1,0)
z2<-ifelse(smallLabSet$Study == "FECYCLE1",1,0)
z22<-ifelse(smallLabSet$Study == "FECYCLE2",1,0)
z20<-ifelse(smallLabSet$Study == "GEOTRACES",1,0)
z19<-ifelse(smallLabSet$Study == "GEOTRACES_LEG3",1,0)
z16<-ifelse(smallLabSet$Study == "KH04_5",1,0)
z21<-ifelse(smallLabSet$Study == "KH05_2",1,0)
z5<-ifelse(smallLabSet$Study == "GREENLAND2012",1,0)
z25<-ifelse(smallLabSet$Study == "INDIANOCEAN2006",1,0)
z18<-ifelse(smallLabSet$Study == "MOVE",1,0)
z10<-ifelse(smallLabSet$Study == "NASB2005",1,0)
z23<-ifelse(smallLabSet$Study == "POWOW",1,0)
z17<-ifelse(smallLabSet$Study == "RAUNEFJORD2000",1,0)
z1<-ifelse(smallLabSet$Study == "SOG",1,0)
z9<-ifelse(smallLabSet$Study == "STRATIPHYT1",1,0)
z11<-ifelse(smallLabSet$Study == "STRATIPHYT2",1,0)
#z26<-ifelse(smallLabSet$Study == "SWAT",1,0)
z15<-ifelse(smallLabSet$Study == "TABASCO",1,0)
#z7<-ifelse(smallLabSet$Study == "TROUT",1,0)
z14<-ifelse(smallLabSet$Study == "USC MO",1,0)
y<-smallLabSet$log10VIRUS
x<-smallLabSet$log10BACTERIA
summary(lm(log10VIRUS~log10BACTERIA,data=smallLabSet))$coef
3.9505725 + 0.11871402
3.9505725 - 0.11871402
y
y<-smallLabSet$log10VIRUS
x<-smallLabSet$log10BACTERIA
summary(lm(log10VIRUS~log10BACTERIA,data=smallLabSet))$coef
variableInterceptwithconstraints<-nls(y~slope*x+SOG*z1+FECYCLE1*z2+NORTHSEA2001*z3+ARCTICSBI*z4+GREENLAND2012*z5+BEDFORDBASIN*z6+CASES0304*z8+STRATAPHYT1*z9+NASB2005*z10+STRATAPHYT2*z11+USCMO*z14+TABASCO*z15+KHO4*z16+Raunefjord*z17+MOVE*z18+GEOTRACES_LEG3*z19+GEOTRACES*z20+KH05_2*z21+FECYCLE2*z22+POWOW*z23+BATS*z24+INDIANOCEAN2006*z25,algorithm="port",
start=c(slope=0,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,SCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858),
lower=c(slope=-Inf,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,USCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858),
upper=c(slope=Inf,SOG=4.069287,FECYCLE1=4.069287,NORTHSEA2001=4.069287,ARCTICSBI=4.069287,GREENLAND2012=4.069287,BEDFORDBASIN=4.069287,CASES0304=4.069287,STRATAPHYT1=4.069287,NASB2005=4.069287,STRATAPHYT2=4.069287,USCMO=4.069287,TABASCO=4.069287,KHO4=4.069287,Raunefjord=4.069287,MOVE=4.069287,GEOTRACES_LEG3=4.069287,GEOTRACES=4.069287,KH05_2=4.069287,FECYCLE2=4.069287,POWOW=4.069287,BATS=4.069287,INDIANOCEAN2006=4.069287))
shallowcv<-variableInterceptwithconstraints
variableInterceptwithconstraints<-nls(y~slope*x+SOG*z1+FECYCLE1*z2+NORTHSEA2001*z3+ARCTICSBI*z4+GREENLAND2012*z5+BEDFORDBASIN*z6+CASES0304*z8+STRATAPHYT1*z9+NASB2005*z10+STRATAPHYT2*z11+USCMO*z14+TABASCO*z15+KHO4*z16+Raunefjord*z17+MOVE*z18+GEOTRACES_LEG3*z19+GEOTRACES*z20+KH05_2*z21+FECYCLE2*z22+POWOW*z23+BATS*z24+INDIANOCEAN2006*z25,algorithm="port",  start=c(slope=0,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,SCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858), lower=c(slope=-Inf,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,USCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858),
upper=c(slope=Inf,SOG=4.069287,FECYCLE1=4.069287,NORTHSEA2001=4.069287,ARCTICSBI=4.069287,GREENLAND2012=4.069287,BEDFORDBASIN=4.069287,CASES0304=4.069287,STRATAPHYT1=4.069287,NASB2005=4.069287,STRATAPHYT2=4.069287,USCMO=4.069287,TABASCO=4.069287,KHO4=4.069287,Raunefjord=4.069287,MOVE=4.069287,GEOTRACES_LEG3=4.069287,GEOTRACES=4.069287,KH05_2=4.069287,FECYCLE2=4.069287,POWOW=4.069287,BATS=4.069287,INDIANOCEAN2006=4.069287))
nls(y~slope*x+SOG*z1+FECYCLE1*z2+NORTHSEA2001*z3+ARCTICSBI*z4+GREENLAND2012*z5+BEDFORDBASIN*z6+CASES0304*z8+STRATAPHYT1*z9+NASB2005*z10+STRATAPHYT2*z11+USCMO*z14+TABASCO*z15+KHO4*z16+Raunefjord*z17+MOVE*z18+GEOTRACES_LEG3*z19+GEOTRACES*z20+KH05_2*z21+FECYCLE2*z22+POWOW*z23+BATS*z24+INDIANOCEAN2006*z25,algorithm="port",  start=c(slope=0,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,SCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858), lower=c(slope=50,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,USCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858),
upper=c(slope=50,SOG=4.069287,FECYCLE1=4.069287,NORTHSEA2001=4.069287,ARCTICSBI=4.069287,GREENLAND2012=4.069287,BEDFORDBASIN=4.069287,CASES0304=4.069287,STRATAPHYT1=4.069287,NASB2005=4.069287,STRATAPHYT2=4.069287,USCMO=4.069287,TABASCO=4.069287,KHO4=4.069287,Raunefjord=4.069287,MOVE=4.069287,GEOTRACES_LEG3=4.069287,GEOTRACES=4.069287,KH05_2=4.069287,FECYCLE2=4.069287,POWOW=4.069287,BATS=4.069287,INDIANOCEAN2006=4.069287))
lm(y~slope*x+SOG*z1+FECYCLE1*z2+NORTHSEA2001*z3+ARCTICSBI*z4+GREENLAND2012*z5+BEDFORDBASIN*z6+CASES0304*z8+STRATAPHYT1*z9+NASB2005*z10+STRATAPHYT2*z11+USCMO*z14+TABASCO*z15+KHO4*z16+Raunefjord*z17+MOVE*z18+GEOTRACES_LEG3*z19+GEOTRACES*z20+KH05_2*z21+FECYCLE2*z22+POWOW*z23+BATS*z24+INDIANOCEAN2006*z25,algorithm="port",  start=c(slope=0,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,SCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858), lower=c(slope=50,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,USCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858),
upper=c(slope=50,SOG=4.069287,FECYCLE1=4.069287,NORTHSEA2001=4.069287,ARCTICSBI=4.069287,GREENLAND2012=4.069287,BEDFORDBASIN=4.069287,CASES0304=4.069287,STRATAPHYT1=4.069287,NASB2005=4.069287,STRATAPHYT2=4.069287,USCMO=4.069287,TABASCO=4.069287,KHO4=4.069287,Raunefjord=4.069287,MOVE=4.069287,GEOTRACES_LEG3=4.069287,GEOTRACES=4.069287,KH05_2=4.069287,FECYCLE2=4.069287,POWOW=4.069287,BATS=4.069287,INDIANOCEAN2006=4.069287))
lm(y~x+SOG*z1+FECYCLE1*z2+NORTHSEA2001*z3+ARCTICSBI*z4+GREENLAND2012*z5+BEDFORDBASIN*z6+CASES0304*z8+STRATAPHYT1*z9+NASB2005*z10+STRATAPHYT2*z11+USCMO*z14+TABASCO*z15+KHO4*z16+Raunefjord*z17+MOVE*z18+GEOTRACES_LEG3*z19+GEOTRACES*z20+KH05_2*z21+FECYCLE2*z22+POWOW*z23+BATS*z24+INDIANOCEAN2006*z25)
SOG
z1
nls(y~slope*x+SOG*z1+FECYCLE1*z2+NORTHSEA2001*z3+ARCTICSBI*z4+GREENLAND2012*z5+BEDFORDBASIN*z6+CASES0304*z8+STRATAPHYT1*z9+NASB2005*z10+STRATAPHYT2*z11+USCMO*z14+TABASCO*z15+KHO4*z16+Raunefjord*z17+MOVE*z18+GEOTRACES_LEG3*z19+GEOTRACES*z20+KH05_2*z21+FECYCLE2*z22+POWOW*z23+BATS*z24+INDIANOCEAN2006*z25,algorithm="port",  start=c(slope=0,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,SCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858), lower=c(slope=50,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,USCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858),
upper=c(slope=50,SOG=4.069287,FECYCLE1=4.069287,NORTHSEA2001=4.069287,ARCTICSBI=4.069287,GREENLAND2012=4.069287,BEDFORDBASIN=4.069287,CASES0304=4.069287,STRATAPHYT1=4.069287,NASB2005=4.069287,STRATAPHYT2=4.069287,USCMO=4.069287,TABASCO=4.069287,KHO4=4.069287,Raunefjord=4.069287,MOVE=4.069287,GEOTRACES_LEG3=4.069287,GEOTRACES=4.069287,KH05_2=4.069287,FECYCLE2=4.069287,POWOW=4.069287,BATS=4.069287,INDIANOCEAN2006=4.069287))
variableInterceptwithconstraints<-nls(y~slope*x+SOG*z1+FECYCLE1*z2+NORTHSEA2001*z3+ARCTICSBI*z4+GREENLAND2012*z5+BEDFORDBASIN*z6+CASES0304*z8+STRATAPHYT1*z9+NASB2005*z10+STRATAPHYT2*z11+USCMO*z14+TABASCO*z15+KHO4*z16+Raunefjord*z17+MOVE*z18+GEOTRACES_LEG3*z19+GEOTRACES*z20+KH05_2*z21+FECYCLE2*z22+POWOW*z23+BATS*z24+INDIANOCEAN2006*z25,algorithm="port",  start=c(slope=0,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,SCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858), lower=c(slope=50,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,USCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858),
upper=c(slope=50,SOG=4.069287,FECYCLE1=4.069287,NORTHSEA2001=4.069287,ARCTICSBI=4.069287,GREENLAND2012=4.069287,BEDFORDBASIN=4.069287,CASES0304=4.069287,STRATAPHYT1=4.069287,NASB2005=4.069287,STRATAPHYT2=4.069287,USCMO=4.069287,TABASCO=4.069287,KHO4=4.069287,Raunefjord=4.069287,MOVE=4.069287,GEOTRACES_LEG3=4.069287,GEOTRACES=4.069287,KH05_2=4.069287,FECYCLE2=4.069287,POWOW=4.069287,BATS=4.069287,INDIANOCEAN2006=4.069287))
variableInterceptwithconstraints<-nls(y~slope*x+SOG*z1+FECYCLE1*z2+NORTHSEA2001*z3+ARCTICSBI*z4+GREENLAND2012*z5+BEDFORDBASIN*z6+CASES0304*z8+STRATAPHYT1*z9+NASB2005*z10+STRATAPHYT2*z11+USCMO*z14+TABASCO*z15+KHO4*z16+Raunefjord*z17+MOVE*z18+GEOTRACES_LEG3*z19+GEOTRACES*z20+KH05_2*z21+FECYCLE2*z22+POWOW*z23+BATS*z24+INDIANOCEAN2006*z25,algorithm="plinear",  start=c(slope=0,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,SCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858), lower=c(slope=50,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,USCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858),
upper=c(slope=50,SOG=4.069287,FECYCLE1=4.069287,NORTHSEA2001=4.069287,ARCTICSBI=4.069287,GREENLAND2012=4.069287,BEDFORDBASIN=4.069287,CASES0304=4.069287,STRATAPHYT1=4.069287,NASB2005=4.069287,STRATAPHYT2=4.069287,USCMO=4.069287,TABASCO=4.069287,KHO4=4.069287,Raunefjord=4.069287,MOVE=4.069287,GEOTRACES_LEG3=4.069287,GEOTRACES=4.069287,KH05_2=4.069287,FECYCLE2=4.069287,POWOW=4.069287,BATS=4.069287,INDIANOCEAN2006=4.069287))
y
x
str(x)
str(y)
nls(y~slope*x+SOG*z1+FECYCLE1*z2+NORTHSEA2001*z3+ARCTICSBI*z4+GREENLAND2012*z5+BEDFORDBASIN*z6+CASES0304*z8+STRATAPHYT1*z9+NASB2005*z10+STRATAPHYT2*z11+USCMO*z14+TABASCO*z15+KHO4*z16+Raunefjord*z17+MOVE*z18+GEOTRACES_LEG3*z19+GEOTRACES*z20+KH05_2*z21+FECYCLE2*z22+POWOW*z23+BATS*z24+INDIANOCEAN2006*z25,algorithm="port",  start=c(slope=0,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,SCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858), lower=c(slope=-50,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,USCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858),
upper=c(slope=50,SOG=4.069287,FECYCLE1=4.069287,NORTHSEA2001=4.069287,ARCTICSBI=4.069287,GREENLAND2012=4.069287,BEDFORDBASIN=4.069287,CASES0304=4.069287,STRATAPHYT1=4.069287,NASB2005=4.069287,STRATAPHYT2=4.069287,USCMO=4.069287,TABASCO=4.069287,KHO4=4.069287,Raunefjord=4.069287,MOVE=4.069287,GEOTRACES_LEG3=4.069287,GEOTRACES=4.069287,KH05_2=4.069287,FECYCLE2=4.069287,POWOW=4.069287,BATS=4.069287,INDIANOCEAN2006=4.069287))
nls(y~slope*x+SOG*z1+FECYCLE1*z2+NORTHSEA2001*z3+ARCTICSBI*z4+GREENLAND2012*z5+BEDFORDBASIN*z6+CASES0304*z8+STRATAPHYT1*z9+NASB2005*z10+STRATAPHYT2*z11+USCMO*z14+TABASCO*z15+KHO4*z16+Raunefjord*z17+MOVE*z18+GEOTRACES_LEG3*z19+GEOTRACES*z20+KH05_2*z21+FECYCLE2*z22+POWOW*z23+BATS*z24+INDIANOCEAN2006*z25,algorithm="port",  start=c(slope=0,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,SCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858), lower=c(slope=-50,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,USCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858),
upper=c(slope=50,SOG=4.069287,FECYCLE1=4.069287,NORTHSEA2001=4.069287,ARCTICSBI=4.069287,GREENLAND2012=4.069287,BEDFORDBASIN=4.069287,CASES0304=4.069287,STRATAPHYT1=4.069287,NASB2005=4.069287,STRATAPHYT2=4.069287,USCMO=4.069287,TABASCO=4.069287,KHO4=4.069287,Raunefjord=4.069287,MOVE=4.069287,GEOTRACES_LEG3=4.069287,GEOTRACES=4.069287,KH05_2=4.069287,FECYCLE2=4.069287,POWOW=4.069287,BATS=4.069287,INDIANOCEAN2006=4.069287))
nls(y~slope*x+SOG*z1+FECYCLE1*z2+NORTHSEA2001*z3+ARCTICSBI*z4+GREENLAND2012*z5+BEDFORDBASIN*z6+CASES0304*z8+STRATAPHYT1*z9+NASB2005*z10+STRATAPHYT2*z11+USCMO*z14+TABASCO*z15+KHO4*z16+Raunefjord*z17+MOVE*z18+GEOTRACES_LEG3*z19+GEOTRACES*z20+KH05_2*z21+FECYCLE2*z22+POWOW*z23+BATS*z24+INDIANOCEAN2006*z25,algorithm="port",  start=list(slope=0,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,SCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858), lower=list(slope=-50,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,USCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858),
upper=list(slope=50,SOG=4.069287,FECYCLE1=4.069287,NORTHSEA2001=4.069287,ARCTICSBI=4.069287,GREENLAND2012=4.069287,BEDFORDBASIN=4.069287,CASES0304=4.069287,STRATAPHYT1=4.069287,NASB2005=4.069287,STRATAPHYT2=4.069287,USCMO=4.069287,TABASCO=4.069287,KHO4=4.069287,Raunefjord=4.069287,MOVE=4.069287,GEOTRACES_LEG3=4.069287,GEOTRACES=4.069287,KH05_2=4.069287,FECYCLE2=4.069287,POWOW=4.069287,BATS=4.069287,INDIANOCEAN2006=4.069287))
nls(y~slope*x+SOG*z1,,algorithm="port", start=c(slope=0, SOG=3.831858), lower=c(slope=-50, SOG=3.831858),upper=c(slope=50, SOG=4.069287)
)
nls(y~slope*x+SOG*z1+FECYCLE1*z2+NORTHSEA2001*z3+ARCTICSBI*z4+GREENLAND2012*z5+BEDFORDBASIN*z6+CASES0304*z8+STRATAPHYT1*z9+NASB2005*z10+STRATAPHYT2*z11+USCMO*z14+TABASCO*z15+KHO4*z16+Raunefjord*z17+MOVE*z18+GEOTRACES_LEG3*z19+GEOTRACES*z20+KH05_2*z21+FECYCLE2*z22+POWOW*z23+BATS*z24+INDIANOCEAN2006*z25,algorithm="port",  start=c(slope=0,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,USCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858), lower=c(slope=-50,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,USCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858),
upper=c(slope=50,SOG=4.069287,FECYCLE1=4.069287,NORTHSEA2001=4.069287,ARCTICSBI=4.069287,GREENLAND2012=4.069287,BEDFORDBASIN=4.069287,CASES0304=4.069287,STRATAPHYT1=4.069287,NASB2005=4.069287,STRATAPHYT2=4.069287,USCMO=4.069287,TABASCO=4.069287,KHO4=4.069287,Raunefjord=4.069287,MOVE=4.069287,GEOTRACES_LEG3=4.069287,GEOTRACES=4.069287,KH05_2=4.069287,FECYCLE2=4.069287,POWOW=4.069287,BATS=4.069287,INDIANOCEAN2006=4.069287))
ggplot(smallLabSet, aes(x=log10BACTERIA, y=log10VIRUS, colour=Study)) +
geom_point(size=.01, alpha=.01)
ggplot(smallLabSet, aes(x=log10BACTERIA, y=log10VIRUS, colour=Study)) +
geom_point(size=.01, alpha=.01) +
geom_abline(intercept=4.4806966, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.0692870, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8318580, slope=0.4301043, col='darkgreen', size=.25, alpha=1)
ggplot(smallLabSet, aes(x=log10BACTERIA, y=log10VIRUS, colour=Study)) +
geom_point(size=.01, alpha=.01) +
geom_abline(intercept=4.4806966, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.0692870, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8318580, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8318580, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.0692870, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8318580, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.3362559, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8318580, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.3399020, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.0692870, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8318580, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.3896576, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8318580, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.0692870, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8318580, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.0692870, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.0692870, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.831858, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.831858, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.5130411, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.0692870, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.4089481, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8318580, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8318580, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8318580, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
labs(list(x=expression(paste("Microbe abundance per mL (",log[10]," scale)")),
y=expression(paste("Virus abundance per mL (",log[10]," scale)")))) +
geom_abline(intercept=coef(m1)[[1]], slope=coef(m1)[[2]], col='#D55E00', size=2) +
geom_abline(intercept=1, slope=1, col='#0072B2', size=2) +
annotate(size=6,family="Helvetica", fontface="bold",geom="text",x = 5.0, y = 6.35, label = 'B', parse = TRUE) +
annotate(size=6,family="Helvetica", fontface="bold",geom="text",x = 5.0, y = 6.85, label = 'A', parse = TRUE) +
annotate(size=6,family="Helvetica", fontface="bold",geom="text",x = 6.75, y = 6.95, label = "Power Law", parse = F) +
annotate(size=6,family="Helvetica", fontface="bold",geom="text",x = 6.65, y = 7.95, label = as.character(paste("10","1",sep=":")), parse = F) +
theme(aspect.ratio=1,
title = element_text(size=20),
axis.text=element_text(size=16, colour="black"),
axis.title=element_text(size=16,face="bold"),
#text = element_text(size=32),aspect.ratio=1,
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"),
#legend.position = c(.1,.75),
legend.position = 'none',
legend.key = element_rect(fill = "white"),
legend.key.size = unit(.5, "cm")) +
scale_x_continuous(breaks = c(seq(4.5,9,by=.25)),
labels = c(insert_minor(seq(4.5,9,by=.5),1,1)),
#limits = c(4.6,9),
expand = c(0,0)) +
scale_y_continuous(breaks = c(seq(5.5,9,by=.25)),
labels = c(insert_minor(seq(5.5,9,by=.5),1,1)),
#limits = c(min(smallLabSet$log10VIRUS)-1,max(smallLabSet$log10VIRUS)),
#expand = c(0,0)) + colScale
expand = c(0,0))
load("output/data/SMALLLABSET.RData")
z4<-ifelse(smallLabSet$Study == "ARCTICSBI",1,0)
z24<-ifelse(smallLabSet$Study == "BATS",1,0)
z6<-ifelse(smallLabSet$Study == "BEDFORDBASIN",1,0)
z3<-ifelse(smallLabSet$Study == "NORTHSEA2001",1,0)
z8<-ifelse(smallLabSet$Study == "CASES03-04",1,0)
#z12<-ifelse(smallLabSet$Study == "ELA",1,0)
z2<-ifelse(smallLabSet$Study == "FECYCLE1",1,0)
z22<-ifelse(smallLabSet$Study == "FECYCLE2",1,0)
z20<-ifelse(smallLabSet$Study == "GEOTRACES",1,0)
z19<-ifelse(smallLabSet$Study == "GEOTRACES_LEG3",1,0)
z16<-ifelse(smallLabSet$Study == "KH04_5",1,0)
z21<-ifelse(smallLabSet$Study == "KH05_2",1,0)
z5<-ifelse(smallLabSet$Study == "GREENLAND2012",1,0)
z25<-ifelse(smallLabSet$Study == "INDIANOCEAN2006",1,0)
z18<-ifelse(smallLabSet$Study == "MOVE",1,0)
z10<-ifelse(smallLabSet$Study == "NASB2005",1,0)
z23<-ifelse(smallLabSet$Study == "POWOW",1,0)
z17<-ifelse(smallLabSet$Study == "RAUNEFJORD2000",1,0)
z1<-ifelse(smallLabSet$Study == "SOG",1,0)
z9<-ifelse(smallLabSet$Study == "STRATIPHYT1",1,0)
z11<-ifelse(smallLabSet$Study == "STRATIPHYT2",1,0)
#z26<-ifelse(smallLabSet$Study == "SWAT",1,0)
z15<-ifelse(smallLabSet$Study == "TABASCO",1,0)
#z7<-ifelse(smallLabSet$Study == "TROUT",1,0)
z14<-ifelse(smallLabSet$Study == "USC MO",1,0)
y<-smallLabSet$log10VIRUS
x<-smallLabSet$log10BACTERIA
#summary(lm(log10VIRUS~log10BACTERIA,data=smallLabSet))$coef
#estimate + sd on lab intercepts
# 3.9505725 + 0.11871402 = 4.069287
# estimate - sd on lab intercepts
# 3.9505725 - 0.11871402 = 3.831858
variableInterceptwithconstraints<-nls(y~slope*x+SOG*z1+FECYCLE1*z2+NORTHSEA2001*z3+ARCTICSBI*z4+GREENLAND2012*z5+BEDFORDBASIN*z6+CASES0304*z8+STRATAPHYT1*z9+NASB2005*z10+STRATAPHYT2*z11+USCMO*z14+TABASCO*z15+KHO4*z16+Raunefjord*z17+MOVE*z18+GEOTRACES_LEG3*z19+GEOTRACES*z20+KH05_2*z21+FECYCLE2*z22+POWOW*z23+BATS*z24+INDIANOCEAN2006*z25,algorithm="port",  start=c(slope=0,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,USCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858), lower=c(slope=-50,SOG=3.831858,FECYCLE1=3.831858,NORTHSEA2001=3.831858,ARCTICSBI=3.831858,GREENLAND2012=3.831858,BEDFORDBASIN=3.831858,CASES0304=3.831858,STRATAPHYT1=3.831858,NASB2005=3.831858,STRATAPHYT2=3.831858,USCMO=3.831858,TABASCO=3.831858,KHO4=3.831858,Raunefjord=3.831858,MOVE=3.831858,GEOTRACES_LEG3=3.831858,GEOTRACES=3.831858,KH05_2=3.831858,FECYCLE2=3.831858,POWOW=3.831858,BATS=3.831858,INDIANOCEAN2006=3.831858),
upper=c(slope=50,SOG=4.069287,FECYCLE1=4.069287,NORTHSEA2001=4.069287,ARCTICSBI=4.069287,GREENLAND2012=4.069287,BEDFORDBASIN=4.069287,CASES0304=4.069287,STRATAPHYT1=4.069287,NASB2005=4.069287,STRATAPHYT2=4.069287,USCMO=4.069287,TABASCO=4.069287,KHO4=4.069287,Raunefjord=4.069287,MOVE=4.069287,GEOTRACES_LEG3=4.069287,GEOTRACES=4.069287,KH05_2=4.069287,FECYCLE2=4.069287,POWOW=4.069287,BATS=4.069287,INDIANOCEAN2006=4.069287))
lm(y~x+SOG$+FECYCLE1*z2+NORTHSEA2001*z3+ARCTICSBI*z4+GREENLAND2012*z5+BEDFORDBASIN*z6+CASES0304*z8+STRATAPHYT1*z9+NASB2005*z10+STRATAPHYT2*z11+USCMO*z14+TABASCO*z15+KHO4*z16+Raunefjord*z17+MOVE*z18+GEOTRACES_LEG3*z19+GEOTRACES*z20+KH05_2*z21+FECYCLE2*z22+POWOW*z23+BATS*z24+INDIANOCEAN2006*z25)
shallowcv<-variableInterceptwithconstraints
tss<-sum((smallLabSet$log10VIRUS-mean(smallLabSet$log10VIRUS))^2)
m1<-lm(smallLabSet$log10VIRUS ~ smallLabSet$log10BACTERIA)
shallowconstrained<-ggplot(smallLabSet, aes(x=log10BACTERIA, y=log10VIRUS, colour=Study)) +
geom_point(size=.01, alpha=.01) +
geom_abline(intercept=4.4806966, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.0692870, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8318580, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8318580, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.0692870, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8318580, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.3362559, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8318580, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.3399020, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.0692870, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8318580, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.3896576, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8318580, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.0692870, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8318580, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.0692870, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.0692870, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.831858, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.831858, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.5130411, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.0692870, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.4089481, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8318580, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8318580, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8318580, slope=0.4301043, col='darkgreen', size=.25, alpha=1) +
labs(list(x=expression(paste("Microbe abundance per mL (",log[10]," scale)")),
y=expression(paste("Virus abundance per mL (",log[10]," scale)")))) +
geom_abline(intercept=coef(m1)[[1]], slope=coef(m1)[[2]], col='#D55E00', size=2) +
geom_abline(intercept=1, slope=1, col='#0072B2', size=2) +
annotate(size=6,family="Helvetica", fontface="bold",geom="text",x = 5.0, y = 6.35, label = 'B', parse = TRUE) +
annotate(size=6,family="Helvetica", fontface="bold",geom="text",x = 5.0, y = 6.85, label = 'A', parse = TRUE) +
annotate(size=6,family="Helvetica", fontface="bold",geom="text",x = 6.75, y = 6.95, label = "Power Law", parse = F) +
annotate(size=6,family="Helvetica", fontface="bold",geom="text",x = 6.65, y = 7.95, label = as.character(paste("10","1",sep=":")), parse = F) +
theme(aspect.ratio=1,
title = element_text(size=20),
axis.text=element_text(size=16, colour="black"),
axis.title=element_text(size=16,face="bold"),
#text = element_text(size=32),aspect.ratio=1,
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"),
#legend.position = c(.1,.75),
legend.position = 'none',
legend.key = element_rect(fill = "white"),
legend.key.size = unit(.5, "cm")) +
scale_x_continuous(breaks = c(seq(4.5,9,by=.25)),
labels = c(insert_minor(seq(4.5,9,by=.5),1,1)),
#limits = c(4.6,9),
expand = c(0,0)) +
scale_y_continuous(breaks = c(seq(5.5,9,by=.25)),
labels = c(insert_minor(seq(5.5,9,by=.5),1,1)),
#limits = c(min(smallLabSet$log10VIRUS)-1,max(smallLabSet$log10VIRUS)),
#expand = c(0,0)) + colScale
expand = c(0,0)) +
theme(axis.line.x = element_line(color="black", size = 1),
axis.line.y = element_line(color="black", size = 1))
pdf("output/figures/pdf/constrainedRegression.pdf", width=8, height=8)
print(shallowconstrained)
dev.off()
jpeg("output/figures/jpg/constrainedRegression.jpg", width=600, height=600)
print(shallowconstrained)
dev.off()
shallowvariableInterceptwithconstraints<-variableInterceptwithconstraints
saveRDS(predict(variableInterceptwithconstraints), file = "output/data/SHALLOWVARIABLEINTERCEPTWITHCONSTRAINTS.rds")
save(shallowvariableInterceptwithconstraints, file = "output/data/SHALLOWCONSTRAINTS.RData")
variableInterceptwithconstraints
deepconstrained<-ggplot(DeepSmall, aes(x=log10BACTERIA, y=log10VIRUS, colour=Study)) +
geom_point(size=.01, alpha=.01) +
geom_abline(intercept=3.9203, slope=0.5325704, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept= 4.0693, slope=0.5325704, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept= 3.8319, slope=0.5325704, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept= 4.0693, slope=0.5325704, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept= 3.8319, slope=0.5325704, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8319, slope=0.5325704, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8951, slope=0.5325704, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.0693, slope=0.5325704, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept= 3.8319, slope=0.5325704, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=3.8649, slope=0.5325704, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept=4.0693, slope=0.5325704, col='darkgreen', size=.25, alpha=1) +
geom_abline(intercept= 4.0040, slope=0.5325704, col='darkgreen', size=.25, alpha=1) +
labs(list(x=expression(paste("Microbe abundance per mL (",log[10]," scale)")),
y=expression(paste("Virus abundance per mL (",log[10]," scale)")))) +
geom_abline(intercept=coef(m1)[[1]], slope=coef(m1)[[2]], col='#D55E00', size=2) +
geom_abline(intercept=1, slope=1, col='#0072B2', size=2) +
annotate(size=6,family="Helvetica", fontface="bold",geom="text",x = 4, y = 5.45, label = 'Power Law', parse = F) +
annotate(size=6,family="Helvetica", fontface="bold",geom="text",x = 5.7, y = 7.0, label = "10:1", parse = F) +
theme(aspect.ratio=1,
plot.title=element_text(size=20),
axis.text=element_text(size=16),
axis.title=element_text(size=16,face="bold"),
#text = element_text(size=32),aspect.ratio=1,
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"),
legend.position = "NONE") +
scale_x_continuous(breaks = c(seq(3.0,8,by=.25)),
labels = c(insert_minor(seq(3.0,8,by=.5),1,1)),
#limits = c(4.6,8),
expand = c(0,0)) +
scale_y_continuous(breaks = c(seq(3.0,9,by=.25)),
labels = c(insert_minor(seq(3.0,9,by=.5),1,1)),
#limits = c(4.6,9),
expand = c(0,0))
deepconstrained
variableInterceptwithconstraints
ggplot(smallLabSet, aes(x=log10BACTERIA, y=log10VIRUS, colour=Study)) +
geom_point(size=.01, alpha=.01)
str(variableInterceptwithconstraints)
names(variableInterceptwithconstraints)
variableInterceptwithconstraints$data
variableInterceptwithconstraints$data@parent.frame
str(variableInterceptwithconstraints$data)
variableInterceptwithconstraints
str(variableInterceptwithconstraints$data)
variableInterceptwithconstraints$data$parent.frame()
str(variableInterceptwithconstraints$data)
`Names(variableInterceptwithconstraints$data)
)
``
`
Names(variableInterceptwithconstraints$data)
str(variableInterceptwithconstraints$data)
str(variableInterceptwithconstraints$data$language)
variableInterceptwithconstraints
calcRSQ <- function(obs,pred){
ssTotal <- sum((obs-mean(obs))^2)
ssResidual <- sum((obs - pred)^2)
return(1-(ssResidual/ssTotal))
}
insert_minor <- function(major_labs, n_minor,blanks) {labs <-
c( sapply( major_labs, function(x) c(x, rep("", blanks) ) ) )
labs[1:(length(labs)-n_minor)]}
load("DATA.RData")
getwd()
head(data)
data$DeepShallow <- factor(data$DEPTH > 100, labels=c('<=100m', '>100m'))
data$DeepShallow
summary(data$DeepShallow)
